<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Report - {{ portfolio.name }}</title>
    <style>
        @page {
            size: A4;
            margin: 2cm;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Helvetica', 'Arial', sans-serif;
            font-size: 10pt;
            line-height: 1.5;
            color: #333;
        }
        
        .header {
            border-bottom: 3px solid #1a5f7a;
            padding-bottom: 15px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 22pt;
            font-weight: bold;
            color: #1a5f7a;
        }
        
        .logo span {
            color: #ff6b35;
        }
        
        .report-info {
            text-align: right;
            font-size: 9pt;
            color: #666;
        }
        
        h1 {
            font-size: 20pt;
            color: #1a5f7a;
            margin-bottom: 8px;
        }
        
        h2 {
            font-size: 14pt;
            color: #1a5f7a;
            border-bottom: 1px solid #ddd;
            padding-bottom: 8px;
            margin-top: 25px;
            margin-bottom: 15px;
        }
        
        .portfolio-header {
            background: linear-gradient(135deg, #1a5f7a 0%, #2d8aa9 100%);
            color: white;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 25px;
        }
        
        .portfolio-header h1 {
            color: white;
            margin-bottom: 5px;
        }
        
        .portfolio-description {
            font-size: 11pt;
            opacity: 0.9;
        }
        
        .portfolio-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
        }
        
        .stat-value {
            font-size: 22pt;
            font-weight: bold;
        }
        
        .stat-label {
            font-size: 9pt;
            opacity: 0.85;
            margin-top: 5px;
        }
        
        .properties-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        .properties-table th {
            background: #f8f9fa;
            padding: 12px 10px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #ddd;
            font-size: 9pt;
        }
        
        .properties-table td {
            padding: 12px 10px;
            border-bottom: 1px solid #eee;
            vertical-align: top;
        }
        
        .properties-table tr:nth-child(even) {
            background: #fafafa;
        }
        
        .property-name {
            font-weight: 600;
            color: #1a5f7a;
        }
        
        .property-address {
            font-size: 9pt;
            color: #666;
            margin-top: 3px;
        }
        
        .property-notes {
            font-size: 9pt;
            font-style: italic;
            color: #888;
            margin-top: 5px;
            padding: 5px 8px;
            background: #f0f7fa;
            border-radius: 4px;
        }
        
        .price-cell {
            font-weight: bold;
            color: #1a5f7a;
        }
        
        .yield-cell {
            font-weight: bold;
        }
        
        .yield-positive {
            color: #4CAF50;
        }
        
        .yield-neutral {
            color: #FF9800;
        }
        
        .analysis-summary {
            background: #fff8f4;
            border: 1px solid #ffd9c4;
            border-radius: 8px;
            padding: 20px;
            margin-top: 25px;
        }
        
        .analysis-summary h2 {
            color: #ff6b35;
            border-bottom-color: #ffd9c4;
            margin-top: 0;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 15px;
        }
        
        .summary-box {
            background: white;
            padding: 15px;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .summary-box h3 {
            font-size: 10pt;
            color: #666;
            margin-bottom: 10px;
        }
        
        .summary-box ul {
            list-style: none;
            padding: 0;
        }
        
        .summary-box li {
            padding: 5px 0;
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .summary-box li:last-child {
            border-bottom: none;
        }
        
        .chart-placeholder {
            height: 200px;
            background: #f5f5f5;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            margin-top: 15px;
        }
        
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            text-align: center;
            font-size: 8pt;
            color: #666;
        }
        
        .disclaimer {
            margin-top: 10px;
            font-size: 7pt;
            color: #999;
            font-style: italic;
        }
        
        .page-break {
            page-break-before: always;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">Atlas<span>Investor</span></div>
        <div class="report-info">
            <div>Portfolio Investment Report</div>
            <div>{{ generated_at }}</div>
        </div>
    </div>

    <div class="portfolio-header">
        <h1>{{ portfolio.name }}</h1>
        {% if portfolio.description %}
        <div class="portfolio-description">{{ portfolio.description }}</div>
        {% endif %}
        
        <div class="portfolio-stats">
            <div class="stat-card">
                <div class="stat-value">{{ property_count }}</div>
                <div class="stat-label">Properties</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ total_value }}</div>
                <div class="stat-label">Total Value</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ total_monthly_income }}</div>
                <div class="stat-label">Est. Monthly Income</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ avg_yield }}</div>
                <div class="stat-label">Avg. Yield</div>
            </div>
        </div>
    </div>

    <h2>Portfolio Properties</h2>
    <table class="properties-table">
        <thead>
            <tr>
                <th style="width: 35%;">Property</th>
                <th style="width: 15%;">Price</th>
                <th style="width: 12%;">Size</th>
                <th style="width: 12%;">Type</th>
                <th style="width: 13%;">Gross Yield</th>
                <th style="width: 13%;">Cash Flow</th>
            </tr>
        </thead>
        <tbody>
            {% for prop_data in properties %}
            <tr>
                <td>
                    <div class="property-name">{{ prop_data.property.address|truncatechars:40 }}</div>
                    <div class="property-address">
                        {% if prop_data.property.region %}{{ prop_data.property.region.name }}, {% endif %}Portugal
                    </div>
                    {% if prop_data.notes %}
                    <div class="property-notes">üìù {{ prop_data.notes }}</div>
                    {% endif %}
                </td>
                <td class="price-cell">{{ prop_data.price_formatted }}</td>
                <td>{{ prop_data.property.size_sqm }} m¬≤</td>
                <td>{{ prop_data.property.property_type|title }}</td>
                <td class="yield-cell {% if prop_data.analysis.gross_yield and prop_data.analysis.gross_yield > 5 %}yield-positive{% else %}yield-neutral{% endif %}">
                    {% if prop_data.analysis.gross_yield %}
                    {{ prop_data.analysis.gross_yield|floatformat:2 }}%
                    {% else %}
                    N/A
                    {% endif %}
                </td>
                <td>
                    {% if prop_data.analysis.monthly_cash_flow %}
                    ‚Ç¨{{ prop_data.analysis.monthly_cash_flow|floatformat:0 }}/mo
                    {% else %}
                    N/A
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" style="text-align: center; padding: 30px; color: #666;">
                    No properties in this portfolio yet.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% if properties %}
    <div class="analysis-summary">
        <h2>Portfolio Analysis</h2>
        <div class="summary-grid">
            <div class="summary-box">
                <h3>Investment Overview</h3>
                <ul>
                    <li>
                        <span>Total Properties:</span>
                        <strong>{{ property_count }}</strong>
                    </li>
                    <li>
                        <span>Total Portfolio Value:</span>
                        <strong>{{ total_value }}</strong>
                    </li>
                    <li>
                        <span>Average Property Value:</span>
                        <strong>{{ avg_property_value|default:"N/A" }}</strong>
                    </li>
                </ul>
            </div>
            <div class="summary-box">
                <h3>Income Potential</h3>
                <ul>
                    <li>
                        <span>Est. Monthly Income:</span>
                        <strong>{{ total_monthly_income }}</strong>
                    </li>
                    <li>
                        <span>Est. Annual Income:</span>
                        <strong>{{ annual_income|default:"N/A" }}</strong>
                    </li>
                    <li>
                        <span>Portfolio Yield:</span>
                        <strong>{{ avg_yield }}</strong>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="footer">
        <div>Atlas Investor - Real Estate Investment Platform for Portugal</div>
        <div class="disclaimer">
            This report is for informational purposes only and should not be considered financial advice. 
            Income projections are estimates based on regional averages. Please conduct your own due diligence before making investment decisions.
        </div>
    </div>
</body>
</html>

